
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ESP32-C3 USB OTA</title>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    button { font-size: 1.2em; padding: 1em; margin: 1em 0; width: 100%; max-width: 300px; }
  </style>
</head>
<body>
  <h2>Обновление прошивки ESP32-C3 через USB</h2>

  <button onclick="sendBoot()">1. Войти в режим прошивки</button><br>
  <button onclick="installFirmware()">2. Обновить прошивку</button>

  <p id="log"></p>

  <script type="module">
    let port;

    async function sendBoot() {
      try {
        port = await navigator.serial.requestPort();
        await port.open({ baudRate: 115200 });
        const writer = port.writable.getWriter();
        const encoder = new TextEncoder();
        await writer.write(encoder.encode("boot\n"));
        writer.releaseLock();
        document.getElementById("log").textContent = "Команда 'boot' отправлена. Перезагрузка...";
        await port.close();
      } catch (e) {
        document.getElementById("log").textContent = "Ошибка: " + e;
      }
    }

    async function installFirmware() {
      import("https://unpkg.com/esp-web-tools@9.0.2/dist/web/install-button.js?module").then(() => {
        const el = document.createElement("esp-web-install-button");
        el.manifest = "firmware/manifest.json";
        document.body.appendChild(el);
      });
    }
  </script>
</body>
</html>
